"use strict";(self.webpackChunkcrm=self.webpackChunkcrm||[]).push([[550],{6550:(dt,_,r)=>{r.r(_),r.d(_,{ProductModule:()=>ct});var P=r(2935),C=r(1083),l=r(3737),x=r(6580),b=r(4959),s=r(1419),g=r(661),T=r(6679),m=r(5707),p=r(8505),h=r(262),Z=r(4128),t=r(5e3),y=r(6393),f=r(3251),D=r(8099),L=r(7093),v=r(7423),A=r(4834),I=r(9808),c=r(4999),U=r(773);const M=["CategoryTable"];function Q(e,i){1&e&&(t.TgZ(0,"mat-icon",12),t._uU(1,"thumb_up"),t.qZA(),t._uU(2," \u7522\u54c1 "))}function N(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1," # "),t.qZA())}function w(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.index;t.xp6(1),t.hij(" ",o," ")}}function O(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1," \u7522\u54c1\u985e\u5225 "),t.qZA())}function Y(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.$implicit,n=t.oxw(2);t.xp6(1),t.hij(" ",o[n.Table.ProductCategory][n.PCColumn.type]," ")}}function J(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1," \u540d\u7a31 "),t.qZA())}function k(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.$implicit,n=t.oxw(2);t.xp6(1),t.hij(" ",o[n.PColumn.label]," ")}}function E(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1," \u50f9\u683c "),t.qZA())}function R(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.$implicit,n=t.oxw(2);t.xp6(1),t.hij(" ",o[n.PColumn.value]," ")}}function S(e,i){1&e&&t._UZ(0,"tr",21)}function B(e,i){1&e&&t._UZ(0,"tr",22)}function j(e,i){if(1&e&&(t.TgZ(0,"table",13),t.ynx(1,14),t.YNc(2,N,2,0,"th",15),t.YNc(3,w,2,1,"td",16),t.BQk(),t.ynx(4,14),t.YNc(5,O,2,0,"th",15),t.YNc(6,Y,2,1,"td",16),t.BQk(),t.ynx(7,14),t.YNc(8,J,2,0,"th",15),t.YNc(9,k,2,1,"td",16),t.BQk(),t.ynx(10,14),t.YNc(11,E,2,0,"th",15),t.YNc(12,R,2,1,"td",16),t.BQk(),t.YNc(13,S,1,0,"tr",17),t.YNc(14,B,1,0,"tr",18),t.qZA()),2&e){const o=t.oxw();t.Q6J("dataSource",o.productList),t.xp6(1),t.Q6J("matColumnDef",o.IndexColumn),t.xp6(3),t.Q6J("matColumnDef",o.PCColumn.type),t.xp6(3),t.Q6J("matColumnDef",o.PColumn.label),t.xp6(3),t.Q6J("matColumnDef",o.PColumn.value),t.xp6(3),t.Q6J("matHeaderRowDef",o.productColumns),t.xp6(1),t.Q6J("matRowDefColumns",o.productColumns)}}function z(e,i){1&e&&(t.TgZ(0,"mat-icon",12),t._uU(1,"category"),t.qZA(),t._uU(2," \u7522\u54c1\u985e\u5225 "))}function F(e,i){1&e&&(t.TgZ(0,"div",23),t._UZ(1,"mat-progress-spinner",24),t.qZA()),2&e&&(t.Udp("padding","1rem"),t.xp6(1),t.Q6J("mode","indeterminate"))}function H(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1," \u64cd\u4f5c "),t.qZA())}function q(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"td",20)(1,"mat-icon",29),t._uU(2,"reorder"),t.qZA(),t.TgZ(3,"mat-icon",30),t.NdJ("click",function(){const d=t.CHM(o).index;return t.oxw(3).editCategory(d)}),t._uU(4,"edit"),t.qZA()()}}function W(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1," \u9806\u5e8f "),t.qZA())}function $(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.index;t.xp6(1),t.hij(" ",o+1," ")}}function G(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1," \u7522\u54c1\u985e\u5225 "),t.qZA())}function X(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.$implicit,n=t.oxw(3);t.xp6(1),t.hij(" ",o[n.PCColumn.type]," ")}}function K(e,i){1&e&&t._UZ(0,"tr",21)}function V(e,i){1&e&&t._UZ(0,"tr",31),2&e&&t.Q6J("cdkDragData",i.$implicit)}function tt(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"table",26,27),t.NdJ("cdkDropListDropped",function(a){return t.CHM(o),t.oxw(2).categoryDrop(a)}),t.ynx(2,14),t.YNc(3,H,2,0,"th",15),t.YNc(4,q,5,0,"td",16),t.BQk(),t.ynx(5,14),t.YNc(6,W,2,0,"th",15),t.YNc(7,$,2,1,"td",16),t.BQk(),t.ynx(8,14),t.YNc(9,G,2,0,"th",15),t.YNc(10,X,2,1,"td",16),t.BQk(),t.YNc(11,K,1,0,"tr",17),t.YNc(12,V,1,1,"tr",28),t.qZA()}if(2&e){const o=t.oxw(2);t.Q6J("dataSource",o.categoryList)("cdkDropListData",o.categoryList),t.xp6(2),t.Q6J("matColumnDef",o.ColumnOperation),t.xp6(3),t.Q6J("matColumnDef",o.PCColumn.order),t.xp6(3),t.Q6J("matColumnDef",o.PCColumn.type),t.xp6(3),t.Q6J("matHeaderRowDef",o.categoryColumns),t.xp6(1),t.Q6J("matRowDefColumns",o.categoryColumns)}}function et(e,i){if(1&e&&t.YNc(0,tt,13,7,"table",25),2&e){const o=t.oxw(),n=t.MAs(29);t.Q6J("ngIf",o.categoryList.length>0)("ngIfElse",n)}}function ot(e,i){1&e&&(t.TgZ(0,"i",32),t._uU(1,"check"),t.qZA())}function it(e,i){1&e&&t._UZ(0,"mat-progress-spinner",33),2&e&&(t.Udp("display","inline-block"),t.Q6J("diameter",20)("mode","indeterminate"))}function nt(e,i){1&e&&(t.TgZ(0,"h3",23),t._uU(1,"\u67e5\u7121\u8cc7\u6599"),t.qZA()),2&e&&t.Udp("margin","1rem")}const rt=[{path:"list",component:(()=>{class e{constructor(o,n){this.dialogService=o,this.productService=n,this.logger=new b.Y("Product-List"),this.productList=[],this.categoryList=[],this.productColumns=[this.IndexColumn,s.Q.type,g.I.label,g.I.value],this.categoryColumns=[this.ColumnOperation,s.Q.order,s.Q.type],this.ui={loadingProducts:!1,loadingCategories:!1,categoryOrderModified:!1,categoryModifyIndex:{min:0,max:0},updatingCategoryOrder:!1},this.categorySub=this.productService.$productCategoryUpdate.subscribe(()=>{this.getProductList(),this.getCategoryList()})}get IndexColumn(){return"IndexColumn"}get ColumnOperation(){return"ColumnOperation"}get PCColumn(){return s.Q}get PColumn(){return g.I}get Table(){return T.i}ngOnInit(){this.getProductList(),this.getCategoryList()}ngOnDestroy(){this.categorySub.unsubscribe()}getProductList(){this.ui.loadingProducts=!0,this.productService.getProducts().pipe((0,p.b)(o=>{this.ui.loadingProducts=!1,this.productList=o.data||[],this.logger.table("Product List = ",this.productList)}),(0,h.K)(o=>{throw this.logger.error("Get Product list error = ",o),this.ui.loadingProducts=!1,o})).subscribe()}showAddProduct(){const o={mode:m.A.Add,product:new x.xs};this.dialogService.getProductDetailDialog(o).afterClosed().subscribe(a=>{console.log("The dialog was closed")})}getCategoryList(){this.ui.loadingCategories=!0,this.ui.categoryOrderModified=!1,this.productService.getProductCategories().pipe((0,p.b)(o=>{this.ui.loadingCategories=!1,this.categoryList=o.data||[],this.ui.categoryModifyIndex.min=this.categoryList.length,this.ui.categoryModifyIndex.max=0}),(0,h.K)(o=>{throw this.logger.error("Get category list error = ",o),this.ui.loadingCategories=!1,o})).subscribe()}showAddProductCategory(){const o={mode:m.A.Add,productCategory:new x.Pp};this.dialogService.getProductCategoryDetailDialog(o).afterClosed().subscribe(a=>{a&&this.getCategoryList()})}categoryDrop(o){var n;(0,l.bA)(this.categoryList,o.previousIndex,o.currentIndex);const[a,d]=o.previousIndex<o.currentIndex?[o.previousIndex,o.currentIndex]:[o.currentIndex,o.previousIndex];for(let u=a;u<=d;u++)this.categoryList[u][s.Q.order]=u;a<this.ui.categoryModifyIndex.min&&(this.ui.categoryModifyIndex.min=a),d>this.ui.categoryModifyIndex.max&&(this.ui.categoryModifyIndex.max=d),this.ui.categoryOrderModified=!0,null===(n=this.CategoryTable)||void 0===n||n.renderRows()}updateCategoryOrder(){this.ui.updatingCategoryOrder=!0;const o=this.categoryList.filter((n,a)=>this.ui.categoryModifyIndex.min<=a&&a<=this.ui.categoryModifyIndex.max);this.logger.table("updateList",o),(0,Z.D)(o.map(n=>this.productService.updateProductCategoriey(n))).pipe((0,p.b)(()=>{this.ui.categoryOrderModified=!1,this.ui.updatingCategoryOrder=!1,this.ui.categoryModifyIndex={min:this.categoryList.length,max:0}})).subscribe(()=>{},n=>{this.logger.error("update Product Category order error = ",n)})}editCategory(o){this.logger.table("edit category",this.categoryList[o]),this.dialogService.getProductCategoryDetailDialog({mode:m.A.Edit,productCategory:this.categoryList[o]}).afterClosed().subscribe(d=>{d&&this.getCategoryList()})}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(y.xA),t.Y36(y.M5))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-product-list"]],viewQuery:function(o,n){if(1&o&&t.Gf(M,5),2&o){let a;t.iGM(a=t.CRH())&&(n.CategoryTable=a.first)}},decls:30,vars:16,consts:[[1,"module-container"],["mat-tab-label",""],["fxLayout","row","fxLayoutAlign","space-between end"],["type","button","mat-raised-button","","color","primary",3,"click"],["mat-table","","class","mat-elevation-z8",3,"dataSource",4,"ngIf","ngIfElse"],["fxLayout","row","fxLayoutAlign","center center",3,"padding",4,"ngIf","ngIfElse"],["TplCategoryList",""],["fxLayout","row","fxLayoutAlign","end center"],["type","button","mat-raised-button","",3,"disabled","color","click"],["class","material-icons",4,"ngIf","ngIfElse"],["TplNotUpdating",""],["TplNoData",""],[1,"tab-icon"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],[3,"matColumnDef"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],["fxLayout","row","fxLayoutAlign","center center"],[3,"mode"],["mat-table","","class","mat-elevation-z8","cdkDropList","",3,"dataSource","cdkDropListData","cdkDropListDropped",4,"ngIf","ngIfElse"],["mat-table","","cdkDropList","",1,"mat-elevation-z8",3,"dataSource","cdkDropListData","cdkDropListDropped"],["CategoryTable",""],["mat-row","","cdkDrag","","cdkDragLockAxis","y",3,"cdkDragData",4,"matRowDef","matRowDefColumns"],["cdkDragHandle","",1,"drag-handle"],[1,"pointer",3,"click"],["mat-row","","cdkDrag","","cdkDragLockAxis","y",3,"cdkDragData"],[1,"material-icons"],[3,"diameter","mode"]],template:function(o,n){if(1&o&&(t.TgZ(0,"div",0)(1,"mat-tab-group")(2,"mat-tab"),t.YNc(3,Q,3,0,"ng-template",1),t.TgZ(4,"div",2)(5,"h2"),t._uU(6," \u7522\u54c1\u5217\u8868 "),t.qZA(),t.TgZ(7,"button",3),t.NdJ("click",function(){return n.showAddProduct()}),t._uU(8," \u65b0\u589e\u7522\u54c1 "),t.qZA()(),t._UZ(9,"mat-divider"),t.YNc(10,j,15,7,"table",4),t.qZA(),t.TgZ(11,"mat-tab"),t.YNc(12,z,3,0,"ng-template",1),t.TgZ(13,"div",2)(14,"h2"),t._uU(15," \u7522\u54c1\u985e\u5225\u5217\u8868 "),t.qZA(),t.TgZ(16,"button",3),t.NdJ("click",function(){return n.showAddProductCategory()}),t._uU(17," \u65b0\u589e\u7522\u54c1\u985e\u5225 "),t.qZA()(),t._UZ(18,"mat-divider"),t.YNc(19,F,2,3,"div",5),t.YNc(20,et,1,2,"ng-template",null,6,t.W1O),t.TgZ(22,"div",7)(23,"button",8),t.NdJ("click",function(){return n.updateCategoryOrder()}),t.YNc(24,ot,2,0,"i",9),t.YNc(25,it,1,4,"ng-template",null,10,t.W1O),t._uU(27," \u78ba\u8a8d\u4fee\u6539 "),t.qZA()()()(),t.YNc(28,nt,2,2,"ng-template",null,11,t.W1O),t.qZA()),2&o){const a=t.MAs(21),d=t.MAs(26),u=t.MAs(29);t.xp6(4),t.Udp("margin","1rem 0"),t.xp6(1),t.Udp("margin",0),t.xp6(5),t.Q6J("ngIf",n.productList.length>0)("ngIfElse",u),t.xp6(3),t.Udp("margin","1rem 0"),t.xp6(1),t.Udp("margin",0),t.xp6(5),t.Q6J("ngIf",n.ui.loadingCategories)("ngIfElse",a),t.xp6(4),t.Q6J("disabled",!n.ui.categoryOrderModified||n.ui.updatingCategoryOrder)("color","primary"),t.xp6(1),t.Q6J("ngIf",!n.ui.updatingCategoryOrder)("ngIfElse",d)}},directives:[f.SP,f.uX,f.uD,D.Hw,L.xw,L.Wh,v.lW,A.d,I.O5,c.BZ,c.w1,c.fO,c.ge,c.Dz,c.ev,c.as,c.XQ,c.nj,c.Gk,U.Ou,l.Wj,l.Bh,l.Zt],styles:[".tab-icon[_ngcontent-%COMP%]{margin-right:4px}.drag-handle[_ngcontent-%COMP%]{cursor:move}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;width:100%}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}"]}),e})()},{path:"**",redirectTo:"list"}];let at=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[C.Bz.forChild(rt)],C.Bz]}),e})(),ct=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[P.I,at]]}),e})()}}]);