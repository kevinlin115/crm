"use strict";(self.webpackChunkcrm=self.webpackChunkcrm||[]).push([[550],{6550:(W,m,n)=>{n.r(m),n.d(m,{ProductModule:()=>j});var x=n(766),p=n(4100),c=n(3737),L=n(4959),s=n(1419),f=n(5707),C=n(8505),P=n(262),_=n(4128),t=n(5e3),y=n(4211),g=n(3251),T=n(8099),h=n(7093),Z=n(7423),v=n(4834),D=n(9808),A=n(773),d=n(4999);const I=["CategoryTable"];function U(e,i){1&e&&(t.TgZ(0,"mat-icon",10),t._uU(1,"thumb_up"),t.qZA(),t._uU(2," \u7522\u54c1 "))}function b(e,i){1&e&&(t.TgZ(0,"mat-icon",10),t._uU(1,"category"),t.qZA(),t._uU(2," \u7522\u54c1\u985e\u5225 "))}function M(e,i){1&e&&(t.TgZ(0,"div",11),t._UZ(1,"mat-progress-spinner",12),t.qZA()),2&e&&(t.Udp("padding","1rem"),t.xp6(1),t.Q6J("mode","indeterminate"))}function O(e,i){1&e&&(t.TgZ(0,"th",20),t._uU(1," \u64cd\u4f5c "),t.qZA())}function Q(e,i){1&e&&(t.TgZ(0,"td",21)(1,"mat-icon",22),t._uU(2,"reorder"),t.qZA()())}function J(e,i){1&e&&(t.TgZ(0,"th",20),t._uU(1," \u9806\u5e8f "),t.qZA())}function N(e,i){if(1&e&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&e){const o=i.$implicit,r=t.oxw(2);t.xp6(1),t.hij(" ",o[r.PCColumn.order]," ")}}function w(e,i){1&e&&(t.TgZ(0,"th",20),t._uU(1," \u7522\u54c1\u985e\u5225 "),t.qZA())}function Y(e,i){if(1&e&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&e){const o=i.$implicit,r=t.oxw(2);t.xp6(1),t.hij(" ",o[r.PCColumn.type]," ")}}function E(e,i){1&e&&t._UZ(0,"tr",23)}function R(e,i){1&e&&t._UZ(0,"tr",24),2&e&&t.Q6J("cdkDragData",i.$implicit)}function B(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"table",13,14),t.NdJ("cdkDropListDropped",function(a){return t.CHM(o),t.oxw().categoryDrop(a)}),t.ynx(2,15),t.YNc(3,O,2,0,"th",16),t.YNc(4,Q,3,0,"td",17),t.BQk(),t.ynx(5,15),t.YNc(6,J,2,0,"th",16),t.YNc(7,N,2,1,"td",17),t.BQk(),t.ynx(8,15),t.YNc(9,w,2,0,"th",16),t.YNc(10,Y,2,1,"td",17),t.BQk(),t.YNc(11,E,1,0,"tr",18),t.YNc(12,R,1,1,"tr",19),t.qZA()}if(2&e){const o=t.oxw();t.Q6J("dataSource",o.categoryList)("cdkDropListData",o.categoryList),t.xp6(2),t.Q6J("matColumnDef",o.ColumnOperation),t.xp6(3),t.Q6J("matColumnDef",o.PCColumn.order),t.xp6(3),t.Q6J("matColumnDef",o.PCColumn.type),t.xp6(3),t.Q6J("matHeaderRowDef",o.categoryColumns),t.xp6(1),t.Q6J("matRowDefColumns",o.categoryColumns)}}function k(e,i){1&e&&(t.TgZ(0,"i",25),t._uU(1,"check"),t.qZA())}function S(e,i){1&e&&t._UZ(0,"mat-progress-spinner",26),2&e&&(t.Udp("display","inline-block"),t.Q6J("diameter",20)("mode","indeterminate"))}const F=[{path:"list",component:(()=>{class e{constructor(o,r){this.dialogService=o,this.productService=r,this.logger=new L.Y("Product-List"),this.productList=[],this.categoryList=[],this.categoryColumns=[this.ColumnOperation,s.Q.order,s.Q.type],this.ui={loadingCategories:!1,categoryOrderModified:!1,categoryModifyIndex:{min:0,max:0},updatingCategoryOrder:!1}}get ColumnOperation(){return"ColumnOperation"}get PCColumn(){return s.Q}ngOnInit(){this.getProductList(),this.getCategoryList()}getProductList(){}showAddProduct(){this.dialogService.getProductDetailDialog({mode:f.A.Add,label:"",value:0}).afterClosed().subscribe(a=>{console.log("The dialog was closed")})}getCategoryList(){this.ui.loadingCategories=!0,this.productService.getProductCategories().pipe((0,C.b)(o=>{this.ui.loadingCategories=!1,this.categoryList=o.data||[],this.ui.categoryModifyIndex.min=this.categoryList.length,this.ui.categoryModifyIndex.max=0}),(0,P.K)(o=>{throw this.logger.error("Get category list error = ",o),this.ui.loadingCategories=!1,o})).subscribe()}showAddProductCategory(){this.dialogService.getProductCategoryDetailDialog({mode:f.A.Add,type:""}).afterClosed().subscribe(a=>{console.log("The dialog was closed")})}categoryDrop(o){var r;(0,c.bA)(this.categoryList,o.previousIndex,o.currentIndex);const[a,u]=o.previousIndex<o.currentIndex?[o.previousIndex,o.currentIndex]:[o.currentIndex,o.previousIndex];for(let l=a;l<=u;l++)this.categoryList[l][s.Q.order]=l;a<this.ui.categoryModifyIndex.min&&(this.ui.categoryModifyIndex.min=a),u>this.ui.categoryModifyIndex.max&&(this.ui.categoryModifyIndex.max=u),this.ui.categoryOrderModified=!0,null===(r=this.CategoryTable)||void 0===r||r.renderRows()}updateCategoryOrder(){this.ui.updatingCategoryOrder=!0;const o=this.categoryList.filter((r,a)=>this.ui.categoryModifyIndex.min<=a&&a<=this.ui.categoryModifyIndex.max);this.logger.table(o),(0,_.D)(o.map(r=>this.productService.updateProductCategoriey(r))).pipe((0,C.b)(()=>{this.ui.categoryOrderModified=!1,this.ui.updatingCategoryOrder=!1,this.ui.categoryModifyIndex={min:this.categoryList.length,max:0}})).subscribe(()=>{},r=>{this.logger.error("update Product Category order error = ",r)})}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(y.xA),t.Y36(y.M5))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-product-list"]],viewQuery:function(o,r){if(1&o&&t.Gf(I,5),2&o){let a;t.iGM(a=t.CRH())&&(r.CategoryTable=a.first)}},decls:27,vars:14,consts:[[1,"module-container"],["mat-tab-label",""],["fxLayout","row","fxLayoutAlign","space-between end"],["type","button","mat-raised-button","","color","primary",3,"click"],["fxLayout","row","fxLayoutAlign","center center",3,"padding",4,"ngIf","ngIfElse"],["TplCategoryList",""],["fxLayout","row","fxLayoutAlign","end center"],["type","button","mat-raised-button","",3,"disabled","color","click"],["class","material-icons",4,"ngIf","ngIfElse"],["TplNotUpdating",""],[1,"tab-icon"],["fxLayout","row","fxLayoutAlign","center center"],[3,"mode"],["mat-table","","cdkDropList","",1,"mat-elevation-z8",3,"dataSource","cdkDropListData","cdkDropListDropped"],["CategoryTable",""],[3,"matColumnDef"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","cdkDrag","",3,"cdkDragData",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["cdkDragHandle",""],["mat-header-row",""],["mat-row","","cdkDrag","",3,"cdkDragData"],[1,"material-icons"],[3,"diameter","mode"]],template:function(o,r){if(1&o&&(t.TgZ(0,"div",0)(1,"mat-tab-group")(2,"mat-tab"),t.YNc(3,U,3,0,"ng-template",1),t.TgZ(4,"div",2)(5,"h2"),t._uU(6," \u7522\u54c1\u5217\u8868 "),t.qZA(),t.TgZ(7,"button",3),t.NdJ("click",function(){return r.showAddProduct()}),t._uU(8," \u65b0\u589e\u7522\u54c1 "),t.qZA()(),t._UZ(9,"mat-divider"),t.qZA(),t.TgZ(10,"mat-tab"),t.YNc(11,b,3,0,"ng-template",1),t.TgZ(12,"div",2)(13,"h2"),t._uU(14," \u7522\u54c1\u985e\u5225\u5217\u8868 "),t.qZA(),t.TgZ(15,"button",3),t.NdJ("click",function(){return r.showAddProductCategory()}),t._uU(16," \u65b0\u589e\u7522\u54c1\u985e\u5225 "),t.qZA()(),t._UZ(17,"mat-divider"),t.YNc(18,M,2,3,"div",4),t.YNc(19,B,13,7,"ng-template",null,5,t.W1O),t.TgZ(21,"div",6)(22,"button",7),t.NdJ("click",function(){return r.updateCategoryOrder()}),t.YNc(23,k,2,0,"i",8),t.YNc(24,S,1,4,"ng-template",null,9,t.W1O),t._uU(26," \u78ba\u8a8d\u4fee\u6539 "),t.qZA()()()()()),2&o){const a=t.MAs(20),u=t.MAs(25);t.xp6(4),t.Udp("margin","1rem 0"),t.xp6(1),t.Udp("margin",0),t.xp6(7),t.Udp("margin","1rem 0"),t.xp6(1),t.Udp("margin",0),t.xp6(5),t.Q6J("ngIf",r.ui.loadingCategories)("ngIfElse",a),t.xp6(4),t.Q6J("disabled",!r.ui.categoryOrderModified||r.ui.updatingCategoryOrder)("color","primary"),t.xp6(1),t.Q6J("ngIf",!r.ui.updatingCategoryOrder)("ngIfElse",u)}},directives:[g.SP,g.uX,g.uD,T.Hw,h.xw,h.Wh,Z.lW,v.d,D.O5,A.Ou,d.BZ,c.Wj,d.w1,d.fO,d.ge,d.Dz,d.ev,c.Bh,d.as,d.XQ,d.nj,d.Gk,c.Zt],styles:[".tab-icon[_ngcontent-%COMP%]{margin-right:4px}"]}),e})()},{path:"**",redirectTo:"list"}];let H=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[p.Bz.forChild(F)],p.Bz]}),e})(),j=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[x.I,H]]}),e})()}}]);