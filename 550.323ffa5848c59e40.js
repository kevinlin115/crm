"use strict";(self.webpackChunkcrm=self.webpackChunkcrm||[]).push([[550],{6550:(nt,_,n)=>{n.r(_),n.d(_,{ProductModule:()=>rt});var P=n(2935),C=n(1083),s=n(3737),x=n(6580),b=n(4959),g=n(661),l=n(1419),m=n(5707),p=n(8505),h=n(262),T=n(4128),t=n(5e3),y=n(6128),f=n(3251),Z=n(8099),L=n(7093),D=n(7423),v=n(4834),A=n(9808),c=n(4999),I=n(773);const U=["CategoryTable"];function M(e,i){1&e&&(t.TgZ(0,"mat-icon",12),t._uU(1,"thumb_up"),t.qZA(),t._uU(2," \u7522\u54c1 "))}function Q(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1," \u64cd\u4f5c "),t.qZA())}function N(e,i){1&e&&(t.TgZ(0,"td",20)(1,"mat-icon",21),t._uU(2,"reorder"),t.qZA()())}function O(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1," \u9806\u5e8f "),t.qZA())}function J(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.$implicit,r=t.oxw(2);t.xp6(1),t.hij(" ",o[r.PCColumn.order]," ")}}function Y(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1," \u7522\u54c1\u985e\u5225 "),t.qZA())}function k(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.$implicit,r=t.oxw(2);t.xp6(1),t.hij(" ",o[r.PCColumn.type]," ")}}function w(e,i){1&e&&t._UZ(0,"tr",22)}function E(e,i){1&e&&t._UZ(0,"tr",23),2&e&&t.Q6J("cdkDragData",i.$implicit)}function S(e,i){if(1&e&&(t.TgZ(0,"table",13),t.ynx(1,14),t.YNc(2,Q,2,0,"th",15),t.YNc(3,N,3,0,"td",16),t.BQk(),t.ynx(4,14),t.YNc(5,O,2,0,"th",15),t.YNc(6,J,2,1,"td",16),t.BQk(),t.ynx(7,14),t.YNc(8,Y,2,0,"th",15),t.YNc(9,k,2,1,"td",16),t.BQk(),t.YNc(10,w,1,0,"tr",17),t.YNc(11,E,1,1,"tr",18),t.qZA()),2&e){const o=t.oxw();t.Q6J("dataSource",o.productList),t.xp6(1),t.Q6J("matColumnDef",o.ColumnOperation),t.xp6(3),t.Q6J("matColumnDef",o.PCColumn.order),t.xp6(3),t.Q6J("matColumnDef",o.PCColumn.type),t.xp6(3),t.Q6J("matHeaderRowDef",o.categoryColumns),t.xp6(1),t.Q6J("matRowDefColumns",o.categoryColumns)}}function R(e,i){1&e&&(t.TgZ(0,"mat-icon",12),t._uU(1,"category"),t.qZA(),t._uU(2," \u7522\u54c1\u985e\u5225 "))}function B(e,i){1&e&&(t.TgZ(0,"div",24),t._UZ(1,"mat-progress-spinner",25),t.qZA()),2&e&&(t.Udp("padding","1rem"),t.xp6(1),t.Q6J("mode","indeterminate"))}function F(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1," \u64cd\u4f5c "),t.qZA())}function z(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"td",20)(1,"mat-icon",21),t._uU(2,"reorder"),t.qZA(),t.TgZ(3,"mat-icon",29),t.NdJ("click",function(){const d=t.CHM(o).index;return t.oxw(3).editCategory(d)}),t._uU(4,"edit"),t.qZA()()}}function H(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1," \u9806\u5e8f "),t.qZA())}function j(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.index;t.xp6(1),t.hij(" ",o+1," ")}}function W(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1," \u7522\u54c1\u985e\u5225 "),t.qZA())}function $(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.$implicit,r=t.oxw(3);t.xp6(1),t.hij(" ",o[r.PCColumn.type]," ")}}function q(e,i){1&e&&t._UZ(0,"tr",22)}function G(e,i){1&e&&t._UZ(0,"tr",23),2&e&&t.Q6J("cdkDragData",i.$implicit)}function X(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"table",27,28),t.NdJ("cdkDropListDropped",function(a){return t.CHM(o),t.oxw(2).categoryDrop(a)}),t.ynx(2,14),t.YNc(3,F,2,0,"th",15),t.YNc(4,z,5,0,"td",16),t.BQk(),t.ynx(5,14),t.YNc(6,H,2,0,"th",15),t.YNc(7,j,2,1,"td",16),t.BQk(),t.ynx(8,14),t.YNc(9,W,2,0,"th",15),t.YNc(10,$,2,1,"td",16),t.BQk(),t.YNc(11,q,1,0,"tr",17),t.YNc(12,G,1,1,"tr",18),t.qZA()}if(2&e){const o=t.oxw(2);t.Q6J("dataSource",o.categoryList)("cdkDropListData",o.categoryList),t.xp6(2),t.Q6J("matColumnDef",o.ColumnOperation),t.xp6(3),t.Q6J("matColumnDef",o.PCColumn.order),t.xp6(3),t.Q6J("matColumnDef",o.PCColumn.type),t.xp6(3),t.Q6J("matHeaderRowDef",o.categoryColumns),t.xp6(1),t.Q6J("matRowDefColumns",o.categoryColumns)}}function K(e,i){if(1&e&&t.YNc(0,X,13,7,"table",26),2&e){const o=t.oxw(),r=t.MAs(29);t.Q6J("ngIf",o.categoryList.length>0)("ngIfElse",r)}}function V(e,i){1&e&&(t.TgZ(0,"i",30),t._uU(1,"check"),t.qZA())}function tt(e,i){1&e&&t._UZ(0,"mat-progress-spinner",31),2&e&&(t.Udp("display","inline-block"),t.Q6J("diameter",20)("mode","indeterminate"))}function et(e,i){1&e&&(t.TgZ(0,"h3",24),t._uU(1,"\u67e5\u7121\u8cc7\u6599"),t.qZA()),2&e&&t.Udp("margin","1rem")}const ot=[{path:"list",component:(()=>{class e{constructor(o,r){this.dialogService=o,this.productService=r,this.logger=new b.Y("Product-List"),this.productList=[],this.categoryList=[],this.productColumns=[this.IndexColumn,g.I.label,g.I.value,g.I.product_category_id],this.categoryColumns=[this.ColumnOperation,l.Q.order,l.Q.type],this.ui={loadingProducts:!1,loadingCategories:!1,categoryOrderModified:!1,categoryModifyIndex:{min:0,max:0},updatingCategoryOrder:!1},this.categorySub=this.productService.$productCategoryUpdate.subscribe(()=>{this.getProductList(),this.getCategoryList()})}get IndexColumn(){return"IndexColumn"}get ColumnOperation(){return"ColumnOperation"}get PCColumn(){return l.Q}ngOnInit(){this.getProductList(),this.getCategoryList()}ngOnDestroy(){this.categorySub.unsubscribe()}getProductList(){this.ui.loadingProducts=!0,this.productService.getProducts().pipe((0,p.b)(o=>{this.ui.loadingProducts=!1,this.productList=o.data||[],this.logger.table("Product List = ",this.productList)}),(0,h.K)(o=>{throw this.logger.error("Get Product list error = ",o),this.ui.loadingProducts=!1,o})).subscribe()}showAddProduct(){const o={mode:m.A.Add,product:new x.xs};this.dialogService.getProductDetailDialog(o).afterClosed().subscribe(a=>{console.log("The dialog was closed")})}getCategoryList(){this.ui.loadingCategories=!0,this.ui.categoryOrderModified=!1,this.productService.getProductCategories().pipe((0,p.b)(o=>{this.ui.loadingCategories=!1,this.categoryList=o.data||[],this.ui.categoryModifyIndex.min=this.categoryList.length,this.ui.categoryModifyIndex.max=0}),(0,h.K)(o=>{throw this.logger.error("Get category list error = ",o),this.ui.loadingCategories=!1,o})).subscribe()}showAddProductCategory(){const o={mode:m.A.Add,productCategory:new x.Pp};this.dialogService.getProductCategoryDetailDialog(o).afterClosed().subscribe(a=>{a&&this.getCategoryList()})}categoryDrop(o){var r;(0,s.bA)(this.categoryList,o.previousIndex,o.currentIndex);const[a,d]=o.previousIndex<o.currentIndex?[o.previousIndex,o.currentIndex]:[o.currentIndex,o.previousIndex];for(let u=a;u<=d;u++)this.categoryList[u][l.Q.order]=u;a<this.ui.categoryModifyIndex.min&&(this.ui.categoryModifyIndex.min=a),d>this.ui.categoryModifyIndex.max&&(this.ui.categoryModifyIndex.max=d),this.ui.categoryOrderModified=!0,null===(r=this.CategoryTable)||void 0===r||r.renderRows()}updateCategoryOrder(){this.ui.updatingCategoryOrder=!0;const o=this.categoryList.filter((r,a)=>this.ui.categoryModifyIndex.min<=a&&a<=this.ui.categoryModifyIndex.max);this.logger.table("updateList",o),(0,T.D)(o.map(r=>this.productService.updateProductCategoriey(r))).pipe((0,p.b)(()=>{this.ui.categoryOrderModified=!1,this.ui.updatingCategoryOrder=!1,this.ui.categoryModifyIndex={min:this.categoryList.length,max:0}})).subscribe(()=>{},r=>{this.logger.error("update Product Category order error = ",r)})}editCategory(o){this.logger.table("edit category",this.categoryList[o]),this.dialogService.getProductCategoryDetailDialog({mode:m.A.Edit,productCategory:this.categoryList[o]}).afterClosed().subscribe(d=>{d&&this.getCategoryList()})}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(y.xA),t.Y36(y.M5))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-product-list"]],viewQuery:function(o,r){if(1&o&&t.Gf(U,5),2&o){let a;t.iGM(a=t.CRH())&&(r.CategoryTable=a.first)}},decls:30,vars:16,consts:[[1,"module-container"],["mat-tab-label",""],["fxLayout","row","fxLayoutAlign","space-between end"],["type","button","mat-raised-button","","color","primary",3,"click"],["mat-table","","class","mat-elevation-z8",3,"dataSource",4,"ngIf","ngIfElse"],["fxLayout","row","fxLayoutAlign","center center",3,"padding",4,"ngIf","ngIfElse"],["TplCategoryList",""],["fxLayout","row","fxLayoutAlign","end center"],["type","button","mat-raised-button","",3,"disabled","color","click"],["class","material-icons",4,"ngIf","ngIfElse"],["TplNotUpdating",""],["TplNoData",""],[1,"tab-icon"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],[3,"matColumnDef"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","cdkDrag","","cdkDragLockAxis","y",3,"cdkDragData",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["cdkDragHandle","",1,"drag-handle"],["mat-header-row",""],["mat-row","","cdkDrag","","cdkDragLockAxis","y",3,"cdkDragData"],["fxLayout","row","fxLayoutAlign","center center"],[3,"mode"],["mat-table","","class","mat-elevation-z8","cdkDropList","",3,"dataSource","cdkDropListData","cdkDropListDropped",4,"ngIf","ngIfElse"],["mat-table","","cdkDropList","",1,"mat-elevation-z8",3,"dataSource","cdkDropListData","cdkDropListDropped"],["CategoryTable",""],[1,"pointer",3,"click"],[1,"material-icons"],[3,"diameter","mode"]],template:function(o,r){if(1&o&&(t.TgZ(0,"div",0)(1,"mat-tab-group")(2,"mat-tab"),t.YNc(3,M,3,0,"ng-template",1),t.TgZ(4,"div",2)(5,"h2"),t._uU(6," \u7522\u54c1\u5217\u8868 "),t.qZA(),t.TgZ(7,"button",3),t.NdJ("click",function(){return r.showAddProduct()}),t._uU(8," \u65b0\u589e\u7522\u54c1 "),t.qZA()(),t._UZ(9,"mat-divider"),t.YNc(10,S,12,6,"table",4),t.qZA(),t.TgZ(11,"mat-tab"),t.YNc(12,R,3,0,"ng-template",1),t.TgZ(13,"div",2)(14,"h2"),t._uU(15," \u7522\u54c1\u985e\u5225\u5217\u8868 "),t.qZA(),t.TgZ(16,"button",3),t.NdJ("click",function(){return r.showAddProductCategory()}),t._uU(17," \u65b0\u589e\u7522\u54c1\u985e\u5225 "),t.qZA()(),t._UZ(18,"mat-divider"),t.YNc(19,B,2,3,"div",5),t.YNc(20,K,1,2,"ng-template",null,6,t.W1O),t.TgZ(22,"div",7)(23,"button",8),t.NdJ("click",function(){return r.updateCategoryOrder()}),t.YNc(24,V,2,0,"i",9),t.YNc(25,tt,1,4,"ng-template",null,10,t.W1O),t._uU(27," \u78ba\u8a8d\u4fee\u6539 "),t.qZA()()()(),t.YNc(28,et,2,2,"ng-template",null,11,t.W1O),t.qZA()),2&o){const a=t.MAs(21),d=t.MAs(26),u=t.MAs(29);t.xp6(4),t.Udp("margin","1rem 0"),t.xp6(1),t.Udp("margin",0),t.xp6(5),t.Q6J("ngIf",r.productList.length>0)("ngIfElse",u),t.xp6(3),t.Udp("margin","1rem 0"),t.xp6(1),t.Udp("margin",0),t.xp6(5),t.Q6J("ngIf",r.ui.loadingCategories)("ngIfElse",a),t.xp6(4),t.Q6J("disabled",!r.ui.categoryOrderModified||r.ui.updatingCategoryOrder)("color","primary"),t.xp6(1),t.Q6J("ngIf",!r.ui.updatingCategoryOrder)("ngIfElse",d)}},directives:[f.SP,f.uX,f.uD,Z.Hw,L.xw,L.Wh,D.lW,v.d,A.O5,c.BZ,c.w1,c.fO,c.ge,c.Dz,c.ev,s.Bh,c.as,c.XQ,c.nj,c.Gk,s.Zt,I.Ou,s.Wj],styles:[".tab-icon[_ngcontent-%COMP%]{margin-right:4px}.drag-handle[_ngcontent-%COMP%]{cursor:move}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;width:100%}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}"]}),e})()},{path:"**",redirectTo:"list"}];let it=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[C.Bz.forChild(ot)],C.Bz]}),e})(),rt=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[P.I,it]]}),e})()}}]);